<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/template/masterLayout.xhtml"
	xmlns:sec="http://www.springframework.org/security/tags">
	<ui:define name="pageTitle">#{out.deliveries}</ui:define>
	<ui:define name="head-extra">
		<h:outputStylesheet library="default" name="css/custom.css" />
	</ui:define>
	<ui:define name="content">
		<p:growl id="msg" />
		<p:panel id="orderPanel" header="#{out.new}"
			styleClass="top-margin-20">
			<h:form id="form">
				<p:outputPanel id="courierDatePanel">
					<p:outputLabel for="delDate" value="#{out.packageDoneBy}" />
					<p:calendar id="delDate"
						value="#{newDeliveryBean.delivery.deliveryDate}"
						pattern="yyyy.MM.dd HH:mm">
						<f:convertDateTime pattern="yyyy.MM.dd HH:mm" />
					</p:calendar>
				</p:outputPanel>

				<p:dataTable id="ordersDT" var="order" styleClass="top-margin-20"
					value="#{newDeliveryBean.delivery.orders}" selectionMode="single"
					selection="#{newDeliveryBean.selectedOrder}"
					rowKey="#{order.address}" emptyMessage="#{out.noorderstoshow}">
					<f:facet name="header">
						<h:outputText value="#{out.orders}" />
					</f:facet>
					<p:ajax event="rowSelect"
						listener="#{newDeliveryBean.onOrderRowSelect}" update="orderPanel" />
					<p:column headerText="#{out.address}">
						<h:outputText value="#{order.address}" />
					</p:column>
					<p:column headerText="#{out.deadline}">
						<h:outputText value="#{order.deadline}">
							<f:convertDateTime pattern="yyyy.MM.dd HH:mm" />
						</h:outputText>
					</p:column>
					<p:column style="width:64px;text-align: center">
						<h:commandLink update="ordersDT"
							styleClass="btn-no-margin btn"
							actionListener="#{newDeliveryBean.onOrderRowDelete}"
							value="#{out.remove}">
							<f:attribute name="deleted" value="#{order}" />
						</h:commandLink>
					</p:column>
				</p:dataTable>

				<p:commandLink value="#{out.modify}"
					oncomplete="PF('newOrderW').show();"
					update="newOrderDialog,orderDetails" styleClass="btn-right btn"
					rendered="#{newDeliveryBean.canModify}" />

				<p:commandLink value="#{out.newOrder}"
					actionListener="#{newDeliveryBean.onAddOrderButtonClick}"
					oncomplete="PF('newOrderW').show();" update="newOrderDialog"
					styleClass="btn-right btn" />

				<p:commandLink value="#{out.save}" styleClass="btn-left btn"
					action="#{newDeliveryBean.saveDelivery}" update="msg" />

			</h:form>
		</p:panel>

		<p:dialog id="newOrderDialog" widgetVar="newOrderW" modal="true"
			showEffect="fade" hideEffect="fade" resizable="false"
			header="#{out.newOrder}"
			visible="#{not empty newDeliveryBean.selectedOrder}"
			styleClass="custom-dialog">
			<p:outputPanel id="orderDetails">
				<h:form id="orderForm">

					<h:panelGrid cellpadding="5">
						<p:row>
							<p:column>
								<p:outputLabel for="orderAddr" value="#{out.address}" />
							</p:column>
							<p:column>
								<p:inputText id="orderAddr"
									value="#{newDeliveryBean.selectedOrder.address}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:outputLabel for="payTypeDropdown" value="#{out.payType}" />
							</p:column>
							<p:column>
								<p:selectOneMenu id="payTypeDropdown"
									value="#{newDeliveryBean.selectedPayType}">
									<f:selectItems value="#{newDeliveryBean.payTypes}" var="pt"
										itemValue="#{pt}"
										itemLabel="#{out['PayType.'.concat(pt.name())]}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:outputLabel for="datetime" value="#{out.deadline}" />
							</p:column>
							<p:column>
								<p:calendar id="datetime"
									value="#{newDeliveryBean.selectedOrder.deadline}"
									pattern="yyyy.MM.dd HH:mm">
									<f:convertDateTime pattern="yyyy.MM.dd HH:mm" />
								</p:calendar>
							</p:column>
						</p:row>
						<p:row>
							<p:column colspan="2">
								<p:dataTable id="productsList" var="product"
									value="#{newDeliveryBean.selectedOrder.products}"
									emptyMessage="#{out.noproducttolist}"
									styleClass="top-margin-20" selectionMode="single"
									selection="#{newDeliveryBean.selectedProduct}"
									rowKey="#{product.name}">
									<p:ajax event="rowSelect"
										listener="#{newDeliveryBean.onProductRowSelect}"
										update="orderDetails" />
									<f:facet name="header">
										<h:outputText value="#{out.products}" />
									</f:facet>
									<p:column headerText="#{out.productname}">
										<h:outputText value="#{product.name}" />
									</p:column>
									<p:column headerText="#{out.price}">
										<h:outputText value="#{product.price}">
											<f:convertNumber currencyCode="HUF" />
										</h:outputText>
									</p:column>
								</p:dataTable>
							</p:column>
						</p:row>
					</h:panelGrid>

					<p:outputPanel id="productsButton">

						<p:commandLink value="#{out.save}"
							actionListener="#{newDeliveryBean.onSaveOrderButtonClick}"
							styleClass="btn-left btn" update="msg" />
						<p:commandLink value="#{out.cancel}"
							actionListener="#{newDeliveryBean.onCancelOrderButtonClick}"
							oncomplete="PF('newOrderW').hide();" styleClass="btn-left btn"
							process="@this" />

						<p:commandLink value="#{out.modify}"
							oncomplete="PF('newProductW').show();"
							update="newOrderDialog,orderDetails" styleClass="btn-right btn"
							rendered="#{newDeliveryBean.canModifyProduct}" />

						<p:commandLink value="#{out.newProduct}"
							actionListener="#{newDeliveryBean.onAddProductButtonClick}"
							oncomplete="PF('newProductW').show();" update="newProductDialog"
							styleClass="btn-right btn" />
					</p:outputPanel>

				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:dialog id="newProductDialog" widgetVar="newProductW" modal="true"
			showEffect="fade" hideEffect="fade" resizable="false"
			header="#{out.newProduct}"
			visible="#{not empty newDeliveryBean.selectedProduct}"
			styleClass="custom-dialog">
			<p:outputPanel id="productDetails">
				<h:form id="productForm">
					<h:panelGrid columns="2" columnClasses="label,value"
						cellpadding="5">

						<p:outputLabel for="prodName" value="#{out.name} " />
						<p:inputText id="prodName"
							value="#{newDeliveryBean.selectedProduct.name}" />

						<p:outputLabel for="prodPrice" value="#{out.price}" />
						<p:inputText id="prodPrice"
							value="#{newDeliveryBean.selectedProduct.price}" />
					</h:panelGrid>

					<p:outputPanel id="productDialogButtons">

						<p:commandLink value="#{out.save}"
							actionListener="#{newDeliveryBean.onSaveProductButtonClick}"
							styleClass="btn-left btn" update="msg" />
						<p:commandLink value="#{out.cancel}"
							actionListener="#{newDeliveryBean.onCancelProductButtonClick}"
							oncomplete="PF('newProductW').hide();" styleClass="btn-right btn" />

					</p:outputPanel>

				</h:form>
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>